version: '3'

services:

  ergonode:
    image: openjdk
    container_name: ergonode
    volumes: 
      - './node/:/var/ergo'
      - '/var/ergo/mainnet/.ergo:/var/ergo/.ergo'
    ports:
      - '9053:9052' # rempap for config files
    depends_on: 
      - ergoredis
    working_dir: /var/ergo
    entrypoint: java -jar ergo-4.0.13.jar --mainnet -c ergo.conf

  ergostratum:
    container_name: ergostratum
    build: 
      context: .
      dockerfile: Dockerfile.stratum
    volumes: 
      - './stratum:/var/ergo'
    ports: 
      - "8008:8008" # stratum
    depends_on: 
      - ergonode
    # entrypoint: nodemon ./start.js -e js # restart on js file changes

  ergotulip:
    container_name: ergotulip
    build: 
      context: .
      dockerfile: Dockerfile.tulip
    volumes: 
      - './tulip:/app'
    ports: 
      - '8000:8000'
    # entrypoint: uvicorn main:app --host 0.0.0.0 --debug --port 8000 --reload-dir /app
    depends_on: 
      - ergonode

  ergoredis:
    image: redis
    container_name: ergoredis
    volumes:
      - /var/ergo/mainnet/redis:/data # redis persistence
    ports:
      - '6379:6379'
    entrypoint: redis-server --appendonly yes
